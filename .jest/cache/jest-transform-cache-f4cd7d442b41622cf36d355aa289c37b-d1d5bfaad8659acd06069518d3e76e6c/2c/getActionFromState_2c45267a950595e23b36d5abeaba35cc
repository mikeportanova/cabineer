ae44cc19d1fc62da9d05a5d66febad4b
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getActionFromState;

function getActionFromState(state, options) {
  var _state$index, _normalizedConfig$scr;

  var normalizedConfig = options ? createNormalizedConfigItem(options) : {};
  var routes = state.index != null ? state.routes.slice(0, state.index + 1) : state.routes;

  if (routes.length === 0) {
    return undefined;
  }

  if (!(routes.length === 1 && routes[0].key === undefined || routes.length === 2 && routes[0].key === undefined && routes[0].name === (normalizedConfig === null || normalizedConfig === void 0 ? void 0 : normalizedConfig.initialRouteName) && routes[1].key === undefined)) {
    return {
      type: 'RESET',
      payload: state
    };
  }

  var route = state.routes[(_state$index = state.index) !== null && _state$index !== void 0 ? _state$index : state.routes.length - 1];
  var current = route === null || route === void 0 ? void 0 : route.state;
  var config = normalizedConfig === null || normalizedConfig === void 0 ? void 0 : (_normalizedConfig$scr = normalizedConfig.screens) === null || _normalizedConfig$scr === void 0 ? void 0 : _normalizedConfig$scr[route === null || route === void 0 ? void 0 : route.name];
  var params = Object.assign({}, route.params);
  var payload = route ? {
    name: route.name,
    path: route.path,
    params: params
  } : undefined;

  while (current) {
    var _config, _config2, _config2$screens;

    if (current.routes.length === 0) {
      return undefined;
    }

    var _routes = current.index != null ? current.routes.slice(0, current.index + 1) : current.routes;

    var _route = _routes[_routes.length - 1];
    Object.assign(params, {
      initial: undefined,
      screen: undefined,
      params: undefined,
      state: undefined
    });

    if (_routes.length === 1 && _routes[0].key === undefined) {
      params.initial = true;
      params.screen = _route.name;
    } else if (_routes.length === 2 && _routes[0].key === undefined && _routes[0].name === ((_config = config) === null || _config === void 0 ? void 0 : _config.initialRouteName) && _routes[1].key === undefined) {
      params.initial = false;
      params.screen = _route.name;
    } else {
      params.state = current;
      break;
    }

    if (_route.state) {
      params.params = Object.assign({}, _route.params);
      params = params.params;
    } else {
      params.path = _route.path;
      params.params = _route.params;
    }

    current = _route.state;
    config = (_config2 = config) === null || _config2 === void 0 ? void 0 : (_config2$screens = _config2.screens) === null || _config2$screens === void 0 ? void 0 : _config2$screens[_route.name];
  }

  if (!payload) {
    return;
  }

  return {
    type: 'NAVIGATE',
    payload: payload
  };
}

var createNormalizedConfigItem = function createNormalizedConfigItem(config) {
  return typeof config === 'object' && config != null ? {
    initialRouteName: config.initialRouteName,
    screens: config.screens != null ? createNormalizedConfigs(config.screens) : undefined
  } : {};
};

var createNormalizedConfigs = function createNormalizedConfigs(options) {
  return Object.entries(options).reduce(function (acc, _ref) {
    var _ref2 = (0, _slicedToArray2.default)(_ref, 2),
        k = _ref2[0],
        v = _ref2[1];

    acc[k] = createNormalizedConfigItem(v);
    return acc;
  }, {});
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFNBQVFULE9BQVgscURBQUdVLGlCQUFrQmIsTUFBSyxDQUFDSixJQUF4QixDQUFUTTtFQUNEOztFQUVELElBQUksQ0FBQ0gsT0FBTCxFQUFjO0lBQ1o7RUE5RmtFOztFQW1HcEUsT0FBTztJQUNMRCxJQUFJLEVBQUUsVUFERDtJQUVMQztFQUZLLENBQVA7QUFJRDs7QUFFRCxJQUFNViwwQkFBMEIsR0FBSWEsU0FBOUJiLDBCQUE4QmEsT0FBRDtFQUFBLE9BQ2pDLE9BQU9BLE1BQVAsS0FBa0IsUUFBbEIsSUFBOEJBLE1BQU0sSUFBSSxJQUF4QyxHQUNJO0lBQ0VMLGdCQUFnQixFQUFFSyxNQUFNLENBQUNMLGdCQUQzQjtJQUVFTSxPQUFPLEVBQ0xELE1BQU0sQ0FBQ0MsT0FBUEQsSUFBa0IsSUFBbEJBLEdBQ0lZLHVCQUF1QixDQUFDWixNQUFNLENBQUNDLE9BQVIsQ0FEM0JELEdBRUlSO0VBTFIsQ0FESixHQVFJLEVBVDZCO0FBQUEsQ0FBbkM7O0FBV0EsSUFBTW9CLHVCQUF1QixHQUFJM0IsU0FBM0IyQix1QkFBMkIzQixRQUFEO0VBQUEsT0FDOUJvQixNQUFNLENBQUNRLE9BQVBSLENBQWVwQixPQUFmb0IsRUFBd0JTLE1BQXhCVCxDQUEyRCxVQUFDVSxHQUFELFFBQWlCO0lBQUE7SUFBQSxJQUFWQyxDQUFVO0lBQUEsSUFBUEMsQ0FBTzs7SUFDMUVGLEdBQUcsQ0FBQ0MsQ0FBRCxDQUFIRCxHQUFTNUIsMEJBQTBCLENBQUM4QixDQUFELENBQW5DRjtJQUNBLE9BQU9BLEdBQVA7RUFGRixHQUdHLEVBSEhWLENBRDhCO0FBQUEsQ0FBaEMiLCJuYW1lcyI6WyJnZXRBY3Rpb25Gcm9tU3RhdGUiLCJzdGF0ZSIsIm9wdGlvbnMiLCJub3JtYWxpemVkQ29uZmlnIiwiY3JlYXRlTm9ybWFsaXplZENvbmZpZ0l0ZW0iLCJyb3V0ZXMiLCJpbmRleCIsInNsaWNlIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwia2V5IiwibmFtZSIsImluaXRpYWxSb3V0ZU5hbWUiLCJ0eXBlIiwicGF5bG9hZCIsInJvdXRlIiwiY3VycmVudCIsImNvbmZpZyIsInNjcmVlbnMiLCJfbm9ybWFsaXplZENvbmZpZyRzY3IiLCJwYXJhbXMiLCJwYXRoIiwiT2JqZWN0IiwiYXNzaWduIiwiaW5pdGlhbCIsInNjcmVlbiIsIl9jb25maWciLCJfY29uZmlnMiIsIl9jb25maWcyJHNjcmVlbnMiLCJjcmVhdGVOb3JtYWxpemVkQ29uZmlncyIsImVudHJpZXMiLCJyZWR1Y2UiLCJhY2MiLCJrIiwidiJdLCJzb3VyY2VzIjpbImdldEFjdGlvbkZyb21TdGF0ZS50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUge1xuICBDb21tb25BY3Rpb25zLFxuICBOYXZpZ2F0aW9uU3RhdGUsXG4gIFBhcmFtTGlzdEJhc2UsXG4gIFBhcnRpYWxSb3V0ZSxcbiAgUGFydGlhbFN0YXRlLFxuICBSb3V0ZSxcbn0gZnJvbSAnQHJlYWN0LW5hdmlnYXRpb24vcm91dGVycyc7XG5cbmltcG9ydCB0eXBlIHsgTmF2aWdhdG9yU2NyZWVuUGFyYW1zLCBQYXRoQ29uZmlnLCBQYXRoQ29uZmlnTWFwIH0gZnJvbSAnLi90eXBlcyc7XG5cbnR5cGUgQ29uZmlnSXRlbSA9IHtcbiAgaW5pdGlhbFJvdXRlTmFtZT86IHN0cmluZztcbiAgc2NyZWVucz86IFJlY29yZDxzdHJpbmcsIENvbmZpZ0l0ZW0+O1xufTtcblxudHlwZSBPcHRpb25zID0ge1xuICBpbml0aWFsUm91dGVOYW1lPzogc3RyaW5nO1xuICBzY3JlZW5zOiBQYXRoQ29uZmlnTWFwPG9iamVjdD47XG59O1xuXG50eXBlIE5hdmlnYXRlQWN0aW9uPFN0YXRlIGV4dGVuZHMgTmF2aWdhdGlvblN0YXRlPiA9IHtcbiAgdHlwZTogJ05BVklHQVRFJztcbiAgcGF5bG9hZDoge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBwYXJhbXM/OiBOYXZpZ2F0b3JTY3JlZW5QYXJhbXM8U3RhdGU+O1xuICAgIHBhdGg/OiBzdHJpbmc7XG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBnZXRBY3Rpb25Gcm9tU3RhdGUoXG4gIHN0YXRlOiBQYXJ0aWFsU3RhdGU8TmF2aWdhdGlvblN0YXRlPixcbiAgb3B0aW9ucz86IE9wdGlvbnNcbik6IE5hdmlnYXRlQWN0aW9uPE5hdmlnYXRpb25TdGF0ZT4gfCBDb21tb25BY3Rpb25zLkFjdGlvbiB8IHVuZGVmaW5lZCB7XG4gIC8vIENyZWF0ZSBhIG5vcm1hbGl6ZWQgY29uZmlncyBvYmplY3Qgd2hpY2ggd2lsbCBiZSBlYXNpZXIgdG8gdXNlXG4gIGNvbnN0IG5vcm1hbGl6ZWRDb25maWcgPSBvcHRpb25zXG4gICAgPyBjcmVhdGVOb3JtYWxpemVkQ29uZmlnSXRlbShvcHRpb25zIGFzIFBhdGhDb25maWc8b2JqZWN0PiB8IHN0cmluZylcbiAgICA6IHt9O1xuXG4gIGNvbnN0IHJvdXRlcyA9XG4gICAgc3RhdGUuaW5kZXggIT0gbnVsbCA/IHN0YXRlLnJvdXRlcy5zbGljZSgwLCBzdGF0ZS5pbmRleCArIDEpIDogc3RhdGUucm91dGVzO1xuXG4gIGlmIChyb3V0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGlmIChcbiAgICAhKFxuICAgICAgKHJvdXRlcy5sZW5ndGggPT09IDEgJiYgcm91dGVzWzBdLmtleSA9PT0gdW5kZWZpbmVkKSB8fFxuICAgICAgKHJvdXRlcy5sZW5ndGggPT09IDIgJiZcbiAgICAgICAgcm91dGVzWzBdLmtleSA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgIHJvdXRlc1swXS5uYW1lID09PSBub3JtYWxpemVkQ29uZmlnPy5pbml0aWFsUm91dGVOYW1lICYmXG4gICAgICAgIHJvdXRlc1sxXS5rZXkgPT09IHVuZGVmaW5lZClcbiAgICApXG4gICkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnUkVTRVQnLFxuICAgICAgcGF5bG9hZDogc3RhdGUsXG4gICAgfTtcbiAgfVxuXG4gIGNvbnN0IHJvdXRlID0gc3RhdGUucm91dGVzW3N0YXRlLmluZGV4ID8/IHN0YXRlLnJvdXRlcy5sZW5ndGggLSAxXTtcblxuICBsZXQgY3VycmVudDogUGFydGlhbFN0YXRlPE5hdmlnYXRpb25TdGF0ZT4gfCB1bmRlZmluZWQgPSByb3V0ZT8uc3RhdGU7XG4gIGxldCBjb25maWc6IENvbmZpZ0l0ZW0gfCB1bmRlZmluZWQgPSBub3JtYWxpemVkQ29uZmlnPy5zY3JlZW5zPy5bcm91dGU/Lm5hbWVdO1xuICBsZXQgcGFyYW1zID0geyAuLi5yb3V0ZS5wYXJhbXMgfSBhcyBOYXZpZ2F0b3JTY3JlZW5QYXJhbXM8XG4gICAgUGFyYW1MaXN0QmFzZSxcbiAgICBOYXZpZ2F0aW9uU3RhdGVcbiAgPjtcblxuICBsZXQgcGF5bG9hZCA9IHJvdXRlXG4gICAgPyB7IG5hbWU6IHJvdXRlLm5hbWUsIHBhdGg6IHJvdXRlLnBhdGgsIHBhcmFtcyB9XG4gICAgOiB1bmRlZmluZWQ7XG5cbiAgd2hpbGUgKGN1cnJlbnQpIHtcbiAgICBpZiAoY3VycmVudC5yb3V0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGNvbnN0IHJvdXRlcyA9XG4gICAgICBjdXJyZW50LmluZGV4ICE9IG51bGxcbiAgICAgICAgPyBjdXJyZW50LnJvdXRlcy5zbGljZSgwLCBjdXJyZW50LmluZGV4ICsgMSlcbiAgICAgICAgOiBjdXJyZW50LnJvdXRlcztcblxuICAgIGNvbnN0IHJvdXRlOiBSb3V0ZTxzdHJpbmc+IHwgUGFydGlhbFJvdXRlPFJvdXRlPHN0cmluZz4+ID1cbiAgICAgIHJvdXRlc1tyb3V0ZXMubGVuZ3RoIC0gMV07XG5cbiAgICAvLyBFeHBsaWNpdGx5IHNldCB0byBvdmVycmlkZSBleGlzdGluZyB2YWx1ZSB3aGVuIG1lcmdpbmcgcGFyYW1zXG4gICAgT2JqZWN0LmFzc2lnbihwYXJhbXMsIHtcbiAgICAgIGluaXRpYWw6IHVuZGVmaW5lZCxcbiAgICAgIHNjcmVlbjogdW5kZWZpbmVkLFxuICAgICAgcGFyYW1zOiB1bmRlZmluZWQsXG4gICAgICBzdGF0ZTogdW5kZWZpbmVkLFxuICAgIH0pO1xuXG4gICAgaWYgKHJvdXRlcy5sZW5ndGggPT09IDEgJiYgcm91dGVzWzBdLmtleSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBwYXJhbXMuaW5pdGlhbCA9IHRydWU7XG4gICAgICBwYXJhbXMuc2NyZWVuID0gcm91dGUubmFtZTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgcm91dGVzLmxlbmd0aCA9PT0gMiAmJlxuICAgICAgcm91dGVzWzBdLmtleSA9PT0gdW5kZWZpbmVkICYmXG4gICAgICByb3V0ZXNbMF0ubmFtZSA9PT0gY29uZmlnPy5pbml0aWFsUm91dGVOYW1lICYmXG4gICAgICByb3V0ZXNbMV0ua2V5ID09PSB1bmRlZmluZWRcbiAgICApIHtcbiAgICAgIHBhcmFtcy5pbml0aWFsID0gZmFsc2U7XG4gICAgICBwYXJhbXMuc2NyZWVuID0gcm91dGUubmFtZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGFyYW1zLnN0YXRlID0gY3VycmVudDtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGlmIChyb3V0ZS5zdGF0ZSkge1xuICAgICAgcGFyYW1zLnBhcmFtcyA9IHsgLi4ucm91dGUucGFyYW1zIH07XG4gICAgICBwYXJhbXMgPSBwYXJhbXMucGFyYW1zIGFzIE5hdmlnYXRvclNjcmVlblBhcmFtczxcbiAgICAgICAgUGFyYW1MaXN0QmFzZSxcbiAgICAgICAgTmF2aWdhdGlvblN0YXRlXG4gICAgICA+O1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJhbXMucGF0aCA9IHJvdXRlLnBhdGg7XG4gICAgICBwYXJhbXMucGFyYW1zID0gcm91dGUucGFyYW1zO1xuICAgIH1cblxuICAgIGN1cnJlbnQgPSByb3V0ZS5zdGF0ZTtcbiAgICBjb25maWcgPSBjb25maWc/LnNjcmVlbnM/Lltyb3V0ZS5uYW1lXTtcbiAgfVxuXG4gIGlmICghcGF5bG9hZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIFRyeSB0byBjb25zdHJ1Y3QgcGF5bG9hZCBmb3IgYSBgTkFWSUdBVEVgIGFjdGlvbiBmcm9tIHRoZSBzdGF0ZVxuICAvLyBUaGlzIGxldHMgdXMgcHJlc2VydmUgdGhlIG5hdmlnYXRpb24gc3RhdGUgYW5kIG5vdCBsb3NlIGl0XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ05BVklHQVRFJyxcbiAgICBwYXlsb2FkLFxuICB9O1xufVxuXG5jb25zdCBjcmVhdGVOb3JtYWxpemVkQ29uZmlnSXRlbSA9IChjb25maWc6IFBhdGhDb25maWc8b2JqZWN0PiB8IHN0cmluZykgPT5cbiAgdHlwZW9mIGNvbmZpZyA9PT0gJ29iamVjdCcgJiYgY29uZmlnICE9IG51bGxcbiAgICA/IHtcbiAgICAgICAgaW5pdGlhbFJvdXRlTmFtZTogY29uZmlnLmluaXRpYWxSb3V0ZU5hbWUsXG4gICAgICAgIHNjcmVlbnM6XG4gICAgICAgICAgY29uZmlnLnNjcmVlbnMgIT0gbnVsbFxuICAgICAgICAgICAgPyBjcmVhdGVOb3JtYWxpemVkQ29uZmlncyhjb25maWcuc2NyZWVucylcbiAgICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgfVxuICAgIDoge307XG5cbmNvbnN0IGNyZWF0ZU5vcm1hbGl6ZWRDb25maWdzID0gKG9wdGlvbnM6IFBhdGhDb25maWdNYXA8b2JqZWN0PikgPT5cbiAgT2JqZWN0LmVudHJpZXMob3B0aW9ucykucmVkdWNlPFJlY29yZDxzdHJpbmcsIENvbmZpZ0l0ZW0+PigoYWNjLCBbaywgdl0pID0+IHtcbiAgICBhY2Nba10gPSBjcmVhdGVOb3JtYWxpemVkQ29uZmlnSXRlbSh2KTtcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG4iXX0=